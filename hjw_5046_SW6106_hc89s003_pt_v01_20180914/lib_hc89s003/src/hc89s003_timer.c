/**
*   ************************************************************************************
*                               普芯达电子有限公司
*                               www.chipswinner.com
*   ************************************************************************************
*   @Demo   Version     V1.0.0.0
*   @Date               2018.8.2
*   ************************************************************************************
**/
/***************************************************************************************
*                                    模块性能介绍
*   1、MCU的定时器0，1共有四种工作方式
*      方式0：16位自动重装定时器/计数器
*      方式1：16位定时器/计数器
*      方式2：8位自动重装定时器/计数器
*      方式3：T0分成两个（TL0/TH0）独立的8位定时器/计数器（T1无此模式）
*   ************************************************************************************
*                                    应用注意事项
*   1、方式3时T0占用T1的TR1、TF1及中断源，由于TR1被T0占用，此时需要关闭T1可将T1设为工作
*      方式3
*   2、在方式0（Mode0）时THx(x = 0,1)和TLx(x = 0,1)读写操作遵循先高位后低位。并且在修改
*      重载数据时，低位无论有无改变，只要高位被修改，低位都必须再写入一次，方式 1、2、3
*      时无此要求
***************************************************************************************/


/**************************************************************************************/
#include "timer.h"
#include "register.h"
#include "gpio.h"
/**************************************************************************************/



/***************************************************************************************
* @功能    TIM0 定时1MS
* @说明
* @参数
* @返回值
* @注
***************************************************************************************/
void Timer0_Config(void)
{
    //配置T0定时1MS
    //T0定时器时钟Fosc,禁止T0比较器输出功能
    TCON1 |= TIM_T0X12_FOSC;
    //T0内部16位重装定时
    TMOD &= ~(TIM_GATE0 + TIM_CT0 + TIM_M0_0);
    //定时时间T = (65536 - CNT)/Fosc ==> CNT = 65536 - T*Fosc
    TH0 = 0x83;
    TL0 = 0x00;
    //使能T0
    TCON |= TIM_TR0;
    //开启T0中断
    IE |= INT_ET0_EN;
}
/**************************************************************************************/


/***************************************************************************************
* @功能    TIM1 定时500US,P10输出2K频率方波
* @说明
* @参数
* @返回值
* @注
***************************************************************************************/
void Timer1_Config(void)
{
    //配置T1定时1S
    //T1定时器时钟Fosc,允许T1比较器输出功能
    TCON1 |= (TIM_T1X12_FOSC | TIM_T1OUT);
    //T0内部16位重装定时
    TMOD &= ~(TIM_GATE1 + TIM_CT1 + TIM_M1_0);
    //定时时间T = (65536 - CNT)/Fosc ==> CNT = 65536 - T*Fosc
    TH1 = 0xC1;
    TL1 = 0x80;
    //使能T0
    TCON |= TIM_TR1;
    //  //开启T1中断
    //  IE |= INT_ET1_EN;
    //T1定时输出到P10
    T1_MAP = MAP_RW_PORT_P1 | MAP_RW_PIN_0;
}
/**************************************************************************************/
